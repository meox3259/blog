---
title: 分布式基础 - 分布式事务
tags:
  - 分布式存储
---

本文抄书自《深入理解分布式系统》第5章分布式事务。

# 什么是分布式事务

传统数据库的事务意义为，有一系列数据库操作，希望这些操作作为一个整体，要么全部成功，要么全部失败，同时不希望操作的中间状态暴露。

事务一般需要遵守`ACID`
- 原子性（Atomicity）：一个事务包括的所有操作要么全部完成，要么全部不完成。如果中间步骤失败，那么回滚到初始状态。
- 一致性（Consistency）：在事务开始之前和事务结束以后，数据库的完整性没有被破坏，即需要满足用户给出的约束条件，例如用户指示`A+B=100`，那么数据库需要保证这一点。
- 隔离性（Isolation）：数据库允许多个事务并发对数据进行读写/修改，隔离性防止多个事务并发执行时，由于交叉执行导致数据出现异常。隔离级别有多种。
- 持久性（Durabilty）：事务结束后，对于数据库修改是永久的，出现故障也不能消失，即事务需要下盘。

对于一致性和持久性，单机和分布式区别不大，但是原子性和隔离性比较困难
- 原子提交：如果分布式系统部分节点失效，也需要回滚能力。
- 并发控制：通常涉及锁和多版本并发控制。

# 原子提交
分布式事务的原子性通过原子提交协议（ACP）实现，需要满足以下三个特性
- 协定性（Agreement）：所有进程要么一起提交事务，要么一起终止事务，不能存在一个提交一个中止。
- 有效性（Validity）：如果所有进程都决定提交且没有故障，那么整个系统将一起提交事务，一旦一个进程决定终止事务，那么停止提交。
- 终止性（Termination）：

## 两阶段提交

## 三阶段提交

## Paxos

## Quorum

## Saga事务

# 并发控制

## 悲观并发控制

## 乐观并发控制

## 多版本并发控制